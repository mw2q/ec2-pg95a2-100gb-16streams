BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%steel%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2737367479.33214
 ALGERIA                   |   1997 | 4686309634.89143
 ALGERIA                   |   1996 | 4689281504.56467
 ALGERIA                   |   1995 | 4707653464.72186
 ALGERIA                   |   1994 | 4705953086.96882
 ALGERIA                   |   1993 | 4678712688.47688
 ALGERIA                   |   1992 | 4691300997.71803
 ARGENTINA                 |   1998 | 2727523044.04802
 ARGENTINA                 |   1997 |  4648409828.8399
 ARGENTINA                 |   1996 |  4681595980.0092
 ARGENTINA                 |   1995 | 4651149282.54517
 ARGENTINA                 |   1994 | 4659423711.13721
 ARGENTINA                 |   1993 | 4672057728.52456
 ARGENTINA                 |   1992 | 4659297710.45184
 BRAZIL                    |   1998 | 2732862187.62979
 BRAZIL                    |   1997 | 4684502397.73285
 BRAZIL                    |   1996 | 4703018749.71019
 BRAZIL                    |   1995 | 4683216368.61967
 BRAZIL                    |   1994 | 4692167959.26259
 BRAZIL                    |   1993 | 4691982459.54673
 BRAZIL                    |   1992 | 4684590842.20603
 CANADA                    |   1998 | 2731552141.51996
 CANADA                    |   1997 | 4669463111.75218
 CANADA                    |   1996 | 4673901018.16399
 CANADA                    |   1995 |  4684123234.5125
 CANADA                    |   1994 | 4667272931.45508
 CANADA                    |   1993 | 4685574190.19568
 CANADA                    |   1992 |  4689437739.5341
 CHINA                     |   1998 |  2736174224.4695
 CHINA                     |   1997 | 4664328852.04155
 CHINA                     |   1996 | 4711945233.27969
 CHINA                     |   1995 | 4660559892.79867
 CHINA                     |   1994 | 4685291417.78345
 CHINA                     |   1993 | 4664090590.57402
 CHINA                     |   1992 | 4673488201.53274
 EGYPT                     |   1998 | 2737567186.23643
 EGYPT                     |   1997 | 4683816054.95025
 EGYPT                     |   1996 | 4689548384.43595
 EGYPT                     |   1995 | 4671097231.30005
 EGYPT                     |   1994 | 4667813481.16897
 EGYPT                     |   1993 | 4681598101.23122
 EGYPT                     |   1992 | 4698902983.69275
 ETHIOPIA                  |   1998 |  2773456283.1628
 ETHIOPIA                  |   1997 | 4723898661.33273
 ETHIOPIA                  |   1996 | 4725637435.07705
 ETHIOPIA                  |   1995 | 4709274820.95063
 ETHIOPIA                  |   1994 | 4720850517.71689
 ETHIOPIA                  |   1993 | 4723410571.37041
 ETHIOPIA                  |   1992 | 4757576135.27956
 FRANCE                    |   1998 | 2759636884.38991
 FRANCE                    |   1997 | 4693648304.33988
 FRANCE                    |   1996 | 4711648523.44584
 FRANCE                    |   1995 | 4706153689.06863
 FRANCE                    |   1994 | 4676237983.70381
 FRANCE                    |   1993 | 4705207126.53491
 FRANCE                    |   1992 | 4717330692.69502
 GERMANY                   |   1998 | 2784731088.22382
 GERMANY                   |   1997 |  4693150747.6191
 GERMANY                   |   1996 |  4723708273.7774
 GERMANY                   |   1995 |  4720525293.9453
 GERMANY                   |   1994 | 4713918715.62991
 GERMANY                   |   1993 | 4731851167.79671
 GERMANY                   |   1992 | 4719001477.47143
 INDIA                     |   1998 |  2733777520.7405
 INDIA                     |   1997 | 4680557415.59944
 INDIA                     |   1996 | 4662151978.77915
 INDIA                     |   1995 | 4681260616.61976
 INDIA                     |   1994 | 4672809345.51234
 INDIA                     |   1993 |  4673773713.1361
 INDIA                     |   1992 | 4678226234.20469
 INDONESIA                 |   1998 | 2711514359.92972
 INDONESIA                 |   1997 | 4625650302.83417
 INDONESIA                 |   1996 | 4658406760.06845
 INDONESIA                 |   1995 | 4658120851.41463
 INDONESIA                 |   1994 |  4656056899.9234
 INDONESIA                 |   1993 |  4662724274.8643
 INDONESIA                 |   1992 | 4663328661.98599
 IRAN                      |   1998 | 2728010539.64411
 IRAN                      |   1997 | 4649792454.87991
 IRAN                      |   1996 | 4653607581.26335
 IRAN                      |   1995 | 4635594245.15474
 IRAN                      |   1994 | 4641268178.79881
 IRAN                      |   1993 | 4636228926.42293
 IRAN                      |   1992 | 4668099245.62519
 IRAQ                      |   1998 | 2712014328.90479
 IRAQ                      |   1997 |   4665405317.897
 IRAQ                      |   1996 | 4668413206.12848
 IRAQ                      |   1995 | 4639252407.51169
 IRAQ                      |   1994 | 4657202408.53641
 IRAQ                      |   1993 | 4638069096.83884
 IRAQ                      |   1992 | 4676699037.50918
 JAPAN                     |   1998 | 2723891958.06369
 JAPAN                     |   1997 | 4630424307.09106
 JAPAN                     |   1996 | 4646128888.96538
 JAPAN                     |   1995 | 4662369399.42414
 JAPAN                     |   1994 | 4629965831.84965
 JAPAN                     |   1993 | 4624943445.12971
 JAPAN                     |   1992 |   4655921055.995
 JORDAN                    |   1998 | 2711487937.54944
 JORDAN                    |   1997 | 4628662489.48989
 JORDAN                    |   1996 | 4673655157.57456
 JORDAN                    |   1995 | 4647394720.26696
 JORDAN                    |   1994 | 4660694459.79641
 JORDAN                    |   1993 | 4643281106.79958
 JORDAN                    |   1992 | 4672865442.40758
 KENYA                     |   1998 | 2725992207.26215
 KENYA                     |   1997 | 4639751415.32655
 KENYA                     |   1996 | 4648457721.24205
 KENYA                     |   1995 | 4640837244.60363
 KENYA                     |   1994 | 4645706936.15706
 KENYA                     |   1993 |  4628653969.7182
 KENYA                     |   1992 | 4662039950.01935
 MOROCCO                   |   1998 | 2731701499.94789
 MOROCCO                   |   1997 | 4677073743.65161
 MOROCCO                   |   1996 | 4686333760.06823
 MOROCCO                   |   1995 | 4669383359.62682
 MOROCCO                   |   1994 | 4675705699.04041
 MOROCCO                   |   1993 | 4671217775.40612
 MOROCCO                   |   1992 | 4700052591.64443
 MOZAMBIQUE                |   1998 | 2744625276.09268
 MOZAMBIQUE                |   1997 | 4692735370.43665
 MOZAMBIQUE                |   1996 | 4669312999.05385
 MOZAMBIQUE                |   1995 | 4655508280.03524
 MOZAMBIQUE                |   1994 | 4673164725.59192
 MOZAMBIQUE                |   1993 | 4636973119.59832
 MOZAMBIQUE                |   1992 | 4661342662.87042
 PERU                      |   1998 | 2715936485.53751
 PERU                      |   1997 | 4629994308.80005
 PERU                      |   1996 | 4650220828.82756
 PERU                      |   1995 | 4617487645.04632
 PERU                      |   1994 | 4634834101.03405
 PERU                      |   1993 | 4637813970.00408
 PERU                      |   1992 | 4652041909.83167
 ROMANIA                   |   1998 | 2766617684.63909
 ROMANIA                   |   1997 | 4677338201.22894
 ROMANIA                   |   1996 | 4705629583.96416
 ROMANIA                   |   1995 | 4676328457.26813
 ROMANIA                   |   1994 | 4678066975.90965
 ROMANIA                   |   1993 | 4678448385.26992
 ROMANIA                   |   1992 | 4711166661.15813
 RUSSIA                    |   1998 | 2724141414.66586
 RUSSIA                    |   1997 | 4673605718.14992
 RUSSIA                    |   1996 | 4686453869.04739
 RUSSIA                    |   1995 |  4648182061.0758
 RUSSIA                    |   1994 | 4672898996.19536
 RUSSIA                    |   1993 | 4657881486.71893
 RUSSIA                    |   1992 | 4664247049.70239
 SAUDI ARABIA              |   1998 | 2720132768.87923
 SAUDI ARABIA              |   1997 | 4652634594.13484
 SAUDI ARABIA              |   1996 | 4665636134.87901
 SAUDI ARABIA              |   1995 | 4674311005.12097
 SAUDI ARABIA              |   1994 | 4664363981.97305
 SAUDI ARABIA              |   1993 | 4664357714.77793
 SAUDI ARABIA              |   1992 | 4683566433.75688
 UNITED KINGDOM            |   1998 |  2768923160.2998
 UNITED KINGDOM            |   1997 | 4692924276.29634
 UNITED KINGDOM            |   1996 | 4729560306.46941
 UNITED KINGDOM            |   1995 | 4712358734.59292
 UNITED KINGDOM            |   1994 | 4736085692.13406
 UNITED KINGDOM            |   1993 | 4712914933.92421
 UNITED KINGDOM            |   1992 | 4720932354.01825
 UNITED STATES             |   1998 | 2723626849.64215
 UNITED STATES             |   1997 |  4665464718.7654
 UNITED STATES             |   1996 | 4682743779.98701
 UNITED STATES             |   1995 | 4654119856.00183
 UNITED STATES             |   1994 | 4685651614.78997
 UNITED STATES             |   1993 | 4677704076.03778
 UNITED STATES             |   1992 | 4671711175.95549
 VIETNAM                   |   1998 | 2727537574.97666
 VIETNAM                   |   1997 | 4726152541.76618
 VIETNAM                   |   1996 | 4710453139.37753
 VIETNAM                   |   1995 | 4710251843.81376
 VIETNAM                   |   1994 | 4695693798.65132
 VIETNAM                   |   1993 |  4709732478.1607
 VIETNAM                   |   1992 | 4696552879.71168
(175 rows)

COMMIT;
COMMIT
