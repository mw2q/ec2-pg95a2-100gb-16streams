BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%plum%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2740451156.39526
 ALGERIA                   |   1997 | 4653613093.11796
 ALGERIA                   |   1996 | 4688725440.40873
 ALGERIA                   |   1995 | 4685784166.76849
 ALGERIA                   |   1994 | 4672839908.09317
 ALGERIA                   |   1993 | 4664797823.38686
 ALGERIA                   |   1992 | 4687909051.76146
 ARGENTINA                 |   1998 | 2716435970.76854
 ARGENTINA                 |   1997 | 4636891471.53452
 ARGENTINA                 |   1996 | 4659673278.98665
 ARGENTINA                 |   1995 | 4638498083.43134
 ARGENTINA                 |   1994 |  4642529809.8111
 ARGENTINA                 |   1993 | 4647265722.96411
 ARGENTINA                 |   1992 | 4633917108.71528
 BRAZIL                    |   1998 | 2759210986.68187
 BRAZIL                    |   1997 | 4700161526.71004
 BRAZIL                    |   1996 | 4697111153.92493
 BRAZIL                    |   1995 | 4703133107.18044
 BRAZIL                    |   1994 | 4699551808.50781
 BRAZIL                    |   1993 | 4703306559.94776
 BRAZIL                    |   1992 | 4714023678.25621
 CANADA                    |   1998 | 2740504538.91199
 CANADA                    |   1997 | 4682057480.82634
 CANADA                    |   1996 | 4707952739.99577
 CANADA                    |   1995 | 4675311369.68231
 CANADA                    |   1994 | 4711578187.59137
 CANADA                    |   1993 | 4683710597.93502
 CANADA                    |   1992 | 4676900842.83407
 CHINA                     |   1998 | 2731337672.36515
 CHINA                     |   1997 | 4664824971.32713
 CHINA                     |   1996 | 4693847865.69668
 CHINA                     |   1995 | 4653484561.35775
 CHINA                     |   1994 | 4668119419.06425
 CHINA                     |   1993 | 4634850777.85597
 CHINA                     |   1992 |  4656677508.3274
 EGYPT                     |   1998 | 2737182966.57516
 EGYPT                     |   1997 | 4680210383.66888
 EGYPT                     |   1996 | 4685625767.50146
 EGYPT                     |   1995 | 4665535989.22476
 EGYPT                     |   1994 | 4659822362.13089
 EGYPT                     |   1993 | 4661973492.41498
 EGYPT                     |   1992 | 4684436865.65908
 ETHIOPIA                  |   1998 | 2788260598.54711
 ETHIOPIA                  |   1997 | 4718405717.09598
 ETHIOPIA                  |   1996 | 4728041425.20819
 ETHIOPIA                  |   1995 | 4734127092.97935
 ETHIOPIA                  |   1994 | 4724290910.02084
 ETHIOPIA                  |   1993 | 4726464278.58438
 ETHIOPIA                  |   1992 | 4724740629.65305
 FRANCE                    |   1998 | 2734400496.70035
 FRANCE                    |   1997 | 4692947107.81489
 FRANCE                    |   1996 | 4686020769.73098
 FRANCE                    |   1995 | 4674983839.29531
 FRANCE                    |   1994 | 4684038342.18335
 FRANCE                    |   1993 | 4690966179.09058
 FRANCE                    |   1992 | 4692907352.37828
 GERMANY                   |   1998 | 2745399558.42919
 GERMANY                   |   1997 | 4705106033.58011
 GERMANY                   |   1996 | 4697730078.09048
 GERMANY                   |   1995 | 4648530592.53441
 GERMANY                   |   1994 | 4695267710.94224
 GERMANY                   |   1993 | 4679076714.82372
 GERMANY                   |   1992 | 4698052255.91864
 INDIA                     |   1998 | 2762510711.98594
 INDIA                     |   1997 | 4686807931.72449
 INDIA                     |   1996 | 4673960203.95097
 INDIA                     |   1995 | 4645190835.68248
 INDIA                     |   1994 | 4638140469.35309
 INDIA                     |   1993 | 4662070420.68611
 INDIA                     |   1992 | 4689832038.07836
 INDONESIA                 |   1998 | 2728541873.39267
 INDONESIA                 |   1997 | 4626473996.43862
 INDONESIA                 |   1996 | 4640532994.48719
 INDONESIA                 |   1995 | 4625938905.07444
 INDONESIA                 |   1994 | 4618968915.30232
 INDONESIA                 |   1993 | 4623195124.11175
 INDONESIA                 |   1992 |  4631959693.1225
 IRAN                      |   1998 |  2736417351.4818
 IRAN                      |   1997 | 4643225438.58388
 IRAN                      |   1996 | 4671702131.67688
 IRAN                      |   1995 | 4651582588.75082
 IRAN                      |   1994 |  4650313066.0403
 IRAN                      |   1993 | 4655421275.89493
 IRAN                      |   1992 | 4651118208.96548
 IRAQ                      |   1998 | 2742458060.63025
 IRAQ                      |   1997 | 4679896382.29017
 IRAQ                      |   1996 | 4697378382.60412
 IRAQ                      |   1995 |  4670690428.1417
 IRAQ                      |   1994 | 4663536930.72891
 IRAQ                      |   1993 | 4675051410.66856
 IRAQ                      |   1992 | 4676184896.57875
 JAPAN                     |   1998 | 2717264658.81254
 JAPAN                     |   1997 |  4662726135.4725
 JAPAN                     |   1996 |  4651451544.2558
 JAPAN                     |   1995 | 4653004215.76909
 JAPAN                     |   1994 |  4663343705.9192
 JAPAN                     |   1993 | 4646438349.50521
 JAPAN                     |   1992 | 4653958604.43944
 JORDAN                    |   1998 | 2744314417.99974
 JORDAN                    |   1997 |  4682708576.5163
 JORDAN                    |   1996 | 4706320752.75779
 JORDAN                    |   1995 | 4675436501.50218
 JORDAN                    |   1994 | 4683127692.48532
 JORDAN                    |   1993 | 4670377638.96189
 JORDAN                    |   1992 | 4669150587.65451
 KENYA                     |   1998 | 2714634808.42184
 KENYA                     |   1997 | 4599005710.74891
 KENYA                     |   1996 | 4643370725.95233
 KENYA                     |   1995 | 4614352596.19049
 KENYA                     |   1994 | 4635838754.03702
 KENYA                     |   1993 |  4610924677.7319
 KENYA                     |   1992 | 4634734908.03083
 MOROCCO                   |   1998 | 2732493154.59138
 MOROCCO                   |   1997 | 4669566277.26578
 MOROCCO                   |   1996 | 4705308068.84176
 MOROCCO                   |   1995 | 4695569813.20909
 MOROCCO                   |   1994 | 4680198315.65853
 MOROCCO                   |   1993 |  4653486208.8794
 MOROCCO                   |   1992 | 4705307915.97773
 MOZAMBIQUE                |   1998 | 2755570166.50024
 MOZAMBIQUE                |   1997 | 4682071038.27401
 MOZAMBIQUE                |   1996 | 4703637533.61159
 MOZAMBIQUE                |   1995 | 4673938278.43407
 MOZAMBIQUE                |   1994 |  4687198102.6566
 MOZAMBIQUE                |   1993 | 4675062505.51989
 MOZAMBIQUE                |   1992 | 4700995546.67079
 PERU                      |   1998 | 2729918516.86859
 PERU                      |   1997 |  4655829308.4875
 PERU                      |   1996 | 4646982761.88276
 PERU                      |   1995 | 4622291697.30686
 PERU                      |   1994 | 4639313568.77637
 PERU                      |   1993 | 4660339649.94135
 PERU                      |   1992 | 4679216905.91303
 ROMANIA                   |   1998 |  2769373075.1718
 ROMANIA                   |   1997 | 4674125653.48725
 ROMANIA                   |   1996 | 4724061508.80113
 ROMANIA                   |   1995 | 4677949874.80428
 ROMANIA                   |   1994 | 4679706836.18446
 ROMANIA                   |   1993 | 4698798157.59815
 ROMANIA                   |   1992 | 4678452588.25786
 RUSSIA                    |   1998 | 2731570755.65704
 RUSSIA                    |   1997 | 4675285180.46179
 RUSSIA                    |   1996 | 4683856278.99277
 RUSSIA                    |   1995 | 4680189923.93423
 RUSSIA                    |   1994 | 4667168122.59572
 RUSSIA                    |   1993 | 4700897731.88343
 RUSSIA                    |   1992 | 4686991572.27233
 SAUDI ARABIA              |   1998 | 2734156530.82235
 SAUDI ARABIA              |   1997 | 4648579585.59647
 SAUDI ARABIA              |   1996 |  4650943161.1882
 SAUDI ARABIA              |   1995 | 4659166517.02923
 SAUDI ARABIA              |   1994 | 4669942961.18789
 SAUDI ARABIA              |   1993 | 4637112980.97069
 SAUDI ARABIA              |   1992 | 4657078496.40445
 UNITED KINGDOM            |   1998 | 2757300133.74537
 UNITED KINGDOM            |   1997 | 4695733072.22903
 UNITED KINGDOM            |   1996 | 4700994210.66792
 UNITED KINGDOM            |   1995 | 4693574368.22162
 UNITED KINGDOM            |   1994 |  4693848607.2396
 UNITED KINGDOM            |   1993 | 4712965120.65628
 UNITED KINGDOM            |   1992 | 4713815639.21153
 UNITED STATES             |   1998 | 2754933142.82129
 UNITED STATES             |   1997 | 4683455715.99397
 UNITED STATES             |   1996 | 4694078625.79339
 UNITED STATES             |   1995 | 4681106949.67285
 UNITED STATES             |   1994 |  4695126789.6429
 UNITED STATES             |   1993 | 4689969699.06938
 UNITED STATES             |   1992 | 4722253510.57357
 VIETNAM                   |   1998 | 2736687608.78783
 VIETNAM                   |   1997 | 4716989243.91132
 VIETNAM                   |   1996 | 4699781153.78221
 VIETNAM                   |   1995 | 4680259333.19145
 VIETNAM                   |   1994 | 4711933994.22362
 VIETNAM                   |   1993 | 4706991860.44265
 VIETNAM                   |   1992 | 4698434537.58329
(175 rows)

COMMIT;
COMMIT
