BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%lavender%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2750920231.51041
 ALGERIA                   |   1997 |  4684191094.2921
 ALGERIA                   |   1996 | 4695334474.50997
 ALGERIA                   |   1995 | 4694177421.82394
 ALGERIA                   |   1994 | 4691759507.43707
 ALGERIA                   |   1993 | 4684350851.51976
 ALGERIA                   |   1992 | 4692833734.51628
 ARGENTINA                 |   1998 | 2719153244.34422
 ARGENTINA                 |   1997 |  4648595918.9933
 ARGENTINA                 |   1996 | 4671763227.12272
 ARGENTINA                 |   1995 |  4624060237.0261
 ARGENTINA                 |   1994 | 4653749102.01135
 ARGENTINA                 |   1993 | 4632869100.16787
 ARGENTINA                 |   1992 | 4634367115.83775
 BRAZIL                    |   1998 | 2743933813.99881
 BRAZIL                    |   1997 | 4690126989.83543
 BRAZIL                    |   1996 | 4696781673.70693
 BRAZIL                    |   1995 | 4664950296.69392
 BRAZIL                    |   1994 | 4664056582.25705
 BRAZIL                    |   1993 | 4682189595.00239
 BRAZIL                    |   1992 | 4684834750.90258
 CANADA                    |   1998 | 2743358946.36462
 CANADA                    |   1997 | 4675382865.93271
 CANADA                    |   1996 |  4702169958.5222
 CANADA                    |   1995 | 4705192052.54323
 CANADA                    |   1994 | 4678858722.91818
 CANADA                    |   1993 | 4677515692.07352
 CANADA                    |   1992 | 4683519458.94822
 CHINA                     |   1998 | 2732287143.70579
 CHINA                     |   1997 | 4658927342.38297
 CHINA                     |   1996 | 4687908341.55593
 CHINA                     |   1995 | 4653613130.26519
 CHINA                     |   1994 | 4702443317.38153
 CHINA                     |   1993 | 4687090970.46517
 CHINA                     |   1992 | 4665272761.19772
 EGYPT                     |   1998 | 2726551367.36938
 EGYPT                     |   1997 | 4651131754.37936
 EGYPT                     |   1996 | 4680462146.13284
 EGYPT                     |   1995 | 4667854335.67893
 EGYPT                     |   1994 | 4659159708.16434
 EGYPT                     |   1993 | 4673932056.81764
 EGYPT                     |   1992 | 4654441832.43925
 ETHIOPIA                  |   1998 |   2777274015.908
 ETHIOPIA                  |   1997 | 4698040673.09123
 ETHIOPIA                  |   1996 | 4712208866.30161
 ETHIOPIA                  |   1995 | 4711500827.02551
 ETHIOPIA                  |   1994 | 4723547288.11839
 ETHIOPIA                  |   1993 | 4721796740.94106
 ETHIOPIA                  |   1992 | 4722404601.60085
 FRANCE                    |   1998 | 2727994510.09879
 FRANCE                    |   1997 | 4680125787.72298
 FRANCE                    |   1996 |  4702658184.4667
 FRANCE                    |   1995 |  4674105153.6762
 FRANCE                    |   1994 | 4672122132.28429
 FRANCE                    |   1993 | 4668558010.08429
 FRANCE                    |   1992 | 4691820632.84566
 GERMANY                   |   1998 | 2733672970.41752
 GERMANY                   |   1997 |  4661601414.7659
 GERMANY                   |   1996 | 4704948820.49655
 GERMANY                   |   1995 | 4636405361.39319
 GERMANY                   |   1994 | 4662459093.01464
 GERMANY                   |   1993 | 4678720746.03236
 GERMANY                   |   1992 | 4679040203.99137
 INDIA                     |   1998 | 2745880719.26506
 INDIA                     |   1997 | 4679166545.48949
 INDIA                     |   1996 | 4704398860.02997
 INDIA                     |   1995 | 4666170956.76407
 INDIA                     |   1994 | 4680109847.62206
 INDIA                     |   1993 | 4675665663.22901
 INDIA                     |   1992 | 4706272573.83059
 INDONESIA                 |   1998 | 2724584873.34715
 INDONESIA                 |   1997 | 4636532450.91641
 INDONESIA                 |   1996 | 4648354590.75093
 INDONESIA                 |   1995 | 4652986575.58406
 INDONESIA                 |   1994 |  4633688299.3096
 INDONESIA                 |   1993 | 4642189722.87702
 INDONESIA                 |   1992 | 4629836980.80867
 IRAN                      |   1998 | 2723291745.30533
 IRAN                      |   1997 | 4625995089.17458
 IRAN                      |   1996 | 4664708229.91718
 IRAN                      |   1995 |  4616480937.5195
 IRAN                      |   1994 | 4612535197.69448
 IRAN                      |   1993 | 4635849294.78337
 IRAN                      |   1992 | 4649670088.74938
 IRAQ                      |   1998 | 2727915457.45065
 IRAQ                      |   1997 | 4657090713.11591
 IRAQ                      |   1996 | 4656667310.39449
 IRAQ                      |   1995 | 4650037068.74088
 IRAQ                      |   1994 |  4637618061.2717
 IRAQ                      |   1993 | 4668850144.83442
 IRAQ                      |   1992 | 4699315642.62988
 JAPAN                     |   1998 | 2733636317.03232
 JAPAN                     |   1997 | 4630230414.47387
 JAPAN                     |   1996 | 4660430944.19591
 JAPAN                     |   1995 | 4684776553.93907
 JAPAN                     |   1994 | 4646361708.63329
 JAPAN                     |   1993 | 4629071659.01573
 JAPAN                     |   1992 | 4662965575.26263
 JORDAN                    |   1998 | 2740184846.85516
 JORDAN                    |   1997 | 4665352232.09217
 JORDAN                    |   1996 | 4658993823.74293
 JORDAN                    |   1995 | 4667527822.19514
 JORDAN                    |   1994 | 4643694169.70288
 JORDAN                    |   1993 | 4681827981.73307
 JORDAN                    |   1992 | 4647139464.71103
 KENYA                     |   1998 | 2713063611.60501
 KENYA                     |   1997 | 4615819538.97532
 KENYA                     |   1996 |  4632279804.2765
 KENYA                     |   1995 | 4620845476.14504
 KENYA                     |   1994 | 4636030801.34141
 KENYA                     |   1993 | 4635287641.37099
 KENYA                     |   1992 |  4641620209.2432
 MOROCCO                   |   1998 | 2746620125.05056
 MOROCCO                   |   1997 | 4695402960.23424
 MOROCCO                   |   1996 | 4706463864.72515
 MOROCCO                   |   1995 | 4659194010.49327
 MOROCCO                   |   1994 | 4677302882.09062
 MOROCCO                   |   1993 |  4702204249.4161
 MOROCCO                   |   1992 | 4676127499.07341
 MOZAMBIQUE                |   1998 | 2761141015.39035
 MOZAMBIQUE                |   1997 | 4698190259.93548
 MOZAMBIQUE                |   1996 | 4699438427.81553
 MOZAMBIQUE                |   1995 | 4669048537.36151
 MOZAMBIQUE                |   1994 | 4673514469.82221
 MOZAMBIQUE                |   1993 | 4664663351.18397
 MOZAMBIQUE                |   1992 | 4682172630.27117
 PERU                      |   1998 | 2714555208.43584
 PERU                      |   1997 |  4680873527.1203
 PERU                      |   1996 | 4675729945.00611
 PERU                      |   1995 | 4679267618.93002
 PERU                      |   1994 | 4668235342.60573
 PERU                      |   1993 | 4676656739.04882
 PERU                      |   1992 | 4699137033.05687
 ROMANIA                   |   1998 | 2749822837.72844
 ROMANIA                   |   1997 | 4671952283.47311
 ROMANIA                   |   1996 | 4704505671.73482
 ROMANIA                   |   1995 | 4670212240.41559
 ROMANIA                   |   1994 | 4693321627.34814
 ROMANIA                   |   1993 | 4673438964.31024
 ROMANIA                   |   1992 | 4687587244.28901
 RUSSIA                    |   1998 | 2727914827.39552
 RUSSIA                    |   1997 | 4660413411.76641
 RUSSIA                    |   1996 | 4670668406.04792
 RUSSIA                    |   1995 | 4667089395.25877
 RUSSIA                    |   1994 | 4660714575.42025
 RUSSIA                    |   1993 | 4641997104.67407
 RUSSIA                    |   1992 | 4666500805.94127
 SAUDI ARABIA              |   1998 | 2732920224.15667
 SAUDI ARABIA              |   1997 | 4671530402.21748
 SAUDI ARABIA              |   1996 | 4704898546.90661
 SAUDI ARABIA              |   1995 | 4645947233.05245
 SAUDI ARABIA              |   1994 | 4672204155.50924
 SAUDI ARABIA              |   1993 | 4642629796.62519
 SAUDI ARABIA              |   1992 | 4688399286.97809
 UNITED KINGDOM            |   1998 | 2765000525.31611
 UNITED KINGDOM            |   1997 | 4718083676.02559
 UNITED KINGDOM            |   1996 | 4732085808.55244
 UNITED KINGDOM            |   1995 | 4721016987.89805
 UNITED KINGDOM            |   1994 | 4703156411.04543
 UNITED KINGDOM            |   1993 | 4705634222.02551
 UNITED KINGDOM            |   1992 | 4725952269.13823
 UNITED STATES             |   1998 | 2743498407.14514
 UNITED STATES             |   1997 | 4671186632.68603
 UNITED STATES             |   1996 | 4675743168.44533
 UNITED STATES             |   1995 | 4649691236.34358
 UNITED STATES             |   1994 | 4659756485.42202
 UNITED STATES             |   1993 | 4691038638.48036
 UNITED STATES             |   1992 | 4706620275.54414
 VIETNAM                   |   1998 | 2762450755.65406
 VIETNAM                   |   1997 | 4684038301.74459
 VIETNAM                   |   1996 | 4713047240.44262
 VIETNAM                   |   1995 | 4705490544.82043
 VIETNAM                   |   1994 | 4689945120.64785
 VIETNAM                   |   1993 | 4702202911.13743
 VIETNAM                   |   1992 | 4703903665.84122
(175 rows)

COMMIT;
COMMIT
