BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%dim%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2721521144.04294
 ALGERIA                   |   1997 | 4654486081.74714
 ALGERIA                   |   1996 | 4659139579.30654
 ALGERIA                   |   1995 | 4655122318.87379
 ALGERIA                   |   1994 | 4644041779.73862
 ALGERIA                   |   1993 | 4650693469.12306
 ALGERIA                   |   1992 | 4634388929.53971
 ARGENTINA                 |   1998 | 2729161874.28708
 ARGENTINA                 |   1997 | 4652804543.92416
 ARGENTINA                 |   1996 |  4664456746.5293
 ARGENTINA                 |   1995 | 4636499469.10509
 ARGENTINA                 |   1994 | 4619650209.58552
 ARGENTINA                 |   1993 | 4659725563.30342
 ARGENTINA                 |   1992 | 4626531617.47513
 BRAZIL                    |   1998 | 2746317264.47167
 BRAZIL                    |   1997 | 4662431652.05325
 BRAZIL                    |   1996 | 4656310036.88731
 BRAZIL                    |   1995 | 4664329926.68709
 BRAZIL                    |   1994 | 4679132035.42478
 BRAZIL                    |   1993 | 4633284534.01745
 BRAZIL                    |   1992 | 4676831242.33797
 CANADA                    |   1998 | 2747924146.97336
 CANADA                    |   1997 | 4681093049.35986
 CANADA                    |   1996 | 4690179190.78051
 CANADA                    |   1995 | 4681806463.50975
 CANADA                    |   1994 | 4669708729.40846
 CANADA                    |   1993 | 4680624322.30964
 CANADA                    |   1992 |  4672399331.2348
 CHINA                     |   1998 | 2732347948.33142
 CHINA                     |   1997 | 4662564485.19236
 CHINA                     |   1996 | 4692621087.63956
 CHINA                     |   1995 | 4671882317.91727
 CHINA                     |   1994 | 4652990657.52733
 CHINA                     |   1993 | 4667810719.75171
 CHINA                     |   1992 | 4675061308.42487
 EGYPT                     |   1998 | 2731937705.96519
 EGYPT                     |   1997 | 4663635519.10681
 EGYPT                     |   1996 | 4687364031.10557
 EGYPT                     |   1995 | 4683264088.57204
 EGYPT                     |   1994 | 4682998777.91457
 EGYPT                     |   1993 | 4682077131.05179
 EGYPT                     |   1992 | 4693067208.43044
 ETHIOPIA                  |   1998 | 2767233010.20759
 ETHIOPIA                  |   1997 | 4696417949.24894
 ETHIOPIA                  |   1996 | 4702014828.98279
 ETHIOPIA                  |   1995 | 4697504876.99165
 ETHIOPIA                  |   1994 | 4704500910.64353
 ETHIOPIA                  |   1993 | 4697810702.64114
 ETHIOPIA                  |   1992 | 4688871997.59194
 FRANCE                    |   1998 | 2733350238.66881
 FRANCE                    |   1997 | 4683588395.25143
 FRANCE                    |   1996 | 4672412629.51311
 FRANCE                    |   1995 |  4634187394.8304
 FRANCE                    |   1994 | 4683421157.50946
 FRANCE                    |   1993 | 4667977552.46085
 FRANCE                    |   1992 | 4678084642.22227
 GERMANY                   |   1998 | 2730477164.48292
 GERMANY                   |   1997 | 4667185983.01397
 GERMANY                   |   1996 |  4702046492.4829
 GERMANY                   |   1995 | 4670238637.12856
 GERMANY                   |   1994 | 4649402237.79715
 GERMANY                   |   1993 |  4702388174.7531
 GERMANY                   |   1992 | 4701433990.33539
 INDIA                     |   1998 | 2722223203.30526
 INDIA                     |   1997 | 4664390593.88768
 INDIA                     |   1996 | 4697544697.55146
 INDIA                     |   1995 | 4686375054.10133
 INDIA                     |   1994 |  4673076440.3659
 INDIA                     |   1993 |  4672916379.1077
 INDIA                     |   1992 | 4704117760.07746
 INDONESIA                 |   1998 | 2689254528.34291
 INDONESIA                 |   1997 |  4610571876.8358
 INDONESIA                 |   1996 | 4596989961.94094
 INDONESIA                 |   1995 | 4593532595.55364
 INDONESIA                 |   1994 | 4606809769.37843
 INDONESIA                 |   1993 | 4614657106.10883
 INDONESIA                 |   1992 | 4613135898.75994
 IRAN                      |   1998 | 2726385975.79516
 IRAN                      |   1997 | 4655227869.86541
 IRAN                      |   1996 | 4668983908.94889
 IRAN                      |   1995 | 4653059193.11061
 IRAN                      |   1994 | 4658262197.30306
 IRAN                      |   1993 | 4661924141.14409
 IRAN                      |   1992 | 4688068200.17072
 IRAQ                      |   1998 | 2725121981.88115
 IRAQ                      |   1997 |  4626764536.4539
 IRAQ                      |   1996 | 4639545373.14045
 IRAQ                      |   1995 | 4624754859.26777
 IRAQ                      |   1994 | 4640995956.51959
 IRAQ                      |   1993 | 4622267553.08273
 IRAQ                      |   1992 | 4670544633.04161
 JAPAN                     |   1998 | 2720510803.09382
 JAPAN                     |   1997 | 4619255346.07962
 JAPAN                     |   1996 |  4623948739.4324
 JAPAN                     |   1995 | 4629941357.78944
 JAPAN                     |   1994 | 4633879864.40928
 JAPAN                     |   1993 | 4632981197.99973
 JAPAN                     |   1992 | 4634920376.12432
 JORDAN                    |   1998 | 2731837276.78654
 JORDAN                    |   1997 | 4670399096.30663
 JORDAN                    |   1996 | 4694865944.63532
 JORDAN                    |   1995 | 4665969865.99318
 JORDAN                    |   1994 | 4683635883.63133
 JORDAN                    |   1993 | 4667452487.07844
 JORDAN                    |   1992 | 4681561307.14076
 KENYA                     |   1998 | 2714265735.59675
 KENYA                     |   1997 | 4595870646.82688
 KENYA                     |   1996 | 4638961001.47566
 KENYA                     |   1995 | 4601411037.49365
 KENYA                     |   1994 | 4603280955.77714
 KENYA                     |   1993 | 4631705853.99994
 KENYA                     |   1992 |  4615235267.7728
 MOROCCO                   |   1998 | 2755397047.75637
 MOROCCO                   |   1997 | 4702065741.79572
 MOROCCO                   |   1996 | 4702690160.83285
 MOROCCO                   |   1995 | 4698638301.45008
 MOROCCO                   |   1994 | 4694589438.22688
 MOROCCO                   |   1993 |  4684858838.2798
 MOROCCO                   |   1992 |  4717081266.4918
 MOZAMBIQUE                |   1998 | 2725802702.43151
 MOZAMBIQUE                |   1997 | 4668064776.92661
 MOZAMBIQUE                |   1996 | 4669525626.27057
 MOZAMBIQUE                |   1995 |  4645636166.2907
 MOZAMBIQUE                |   1994 | 4671834872.82243
 MOZAMBIQUE                |   1993 |  4672667796.6102
 MOZAMBIQUE                |   1992 | 4665478300.84505
 PERU                      |   1998 | 2702362123.58413
 PERU                      |   1997 | 4613482618.70745
 PERU                      |   1996 | 4638376462.87436
 PERU                      |   1995 | 4634106308.26622
 PERU                      |   1994 | 4591641720.75983
 PERU                      |   1993 |  4614949145.0075
 PERU                      |   1992 | 4673992413.68037
 ROMANIA                   |   1998 | 2752624899.94291
 ROMANIA                   |   1997 | 4677792664.09478
 ROMANIA                   |   1996 | 4700820923.56908
 ROMANIA                   |   1995 | 4676705701.36729
 ROMANIA                   |   1994 | 4683415652.12263
 ROMANIA                   |   1993 | 4667361162.78854
 ROMANIA                   |   1992 | 4696536190.79774
 RUSSIA                    |   1998 | 2706923582.39934
 RUSSIA                    |   1997 | 4645315992.93297
 RUSSIA                    |   1996 | 4668676723.66123
 RUSSIA                    |   1995 | 4654324824.53651
 RUSSIA                    |   1994 |  4635152245.5429
 RUSSIA                    |   1993 | 4656484265.89848
 RUSSIA                    |   1992 | 4676220052.50506
 SAUDI ARABIA              |   1998 | 2713984828.63201
 SAUDI ARABIA              |   1997 |  4620088336.7673
 SAUDI ARABIA              |   1996 | 4635039025.58603
 SAUDI ARABIA              |   1995 | 4611159524.75116
 SAUDI ARABIA              |   1994 | 4647633544.49773
 SAUDI ARABIA              |   1993 | 4613733741.33902
 SAUDI ARABIA              |   1992 | 4650244377.89808
 UNITED KINGDOM            |   1998 | 2738577840.35817
 UNITED KINGDOM            |   1997 | 4674092183.01775
 UNITED KINGDOM            |   1996 |  4697393791.2277
 UNITED KINGDOM            |   1995 | 4668627240.62432
 UNITED KINGDOM            |   1994 |  4648924830.0827
 UNITED KINGDOM            |   1993 | 4644256691.84943
 UNITED KINGDOM            |   1992 | 4676672045.42878
 UNITED STATES             |   1998 | 2724991844.03148
 UNITED STATES             |   1997 | 4655745141.48681
 UNITED STATES             |   1996 | 4675850030.37843
 UNITED STATES             |   1995 | 4659620646.47031
 UNITED STATES             |   1994 | 4666293704.09909
 UNITED STATES             |   1993 | 4678408847.57428
 UNITED STATES             |   1992 |  4652995684.4507
 VIETNAM                   |   1998 | 2744725915.36882
 VIETNAM                   |   1997 | 4654503862.70226
 VIETNAM                   |   1996 | 4682895650.86462
 VIETNAM                   |   1995 | 4656457282.79775
 VIETNAM                   |   1994 | 4665255046.10755
 VIETNAM                   |   1993 | 4674388054.94577
 VIETNAM                   |   1992 | 4652965941.47295
(175 rows)

COMMIT;
COMMIT
