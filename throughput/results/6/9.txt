BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%rosy%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2732432798.13822
 ALGERIA                   |   1997 | 4666749487.68705
 ALGERIA                   |   1996 | 4681005638.46296
 ALGERIA                   |   1995 | 4669875248.90732
 ALGERIA                   |   1994 | 4651780517.99805
 ALGERIA                   |   1993 | 4683760276.15045
 ALGERIA                   |   1992 |  4700711057.3899
 ARGENTINA                 |   1998 | 2711315136.82627
 ARGENTINA                 |   1997 |  4647213956.8025
 ARGENTINA                 |   1996 | 4660530920.54742
 ARGENTINA                 |   1995 | 4625401397.94793
 ARGENTINA                 |   1994 | 4636208609.53263
 ARGENTINA                 |   1993 | 4650062280.42805
 ARGENTINA                 |   1992 | 4649820699.18264
 BRAZIL                    |   1998 | 2751816762.35291
 BRAZIL                    |   1997 |  4708727294.3535
 BRAZIL                    |   1996 | 4700092624.31214
 BRAZIL                    |   1995 |  4713097468.9811
 BRAZIL                    |   1994 | 4689094617.56696
 BRAZIL                    |   1993 | 4705349092.97615
 BRAZIL                    |   1992 | 4704040467.19002
 CANADA                    |   1998 | 2732136173.81094
 CANADA                    |   1997 | 4668032196.38714
 CANADA                    |   1996 | 4717592528.80812
 CANADA                    |   1995 | 4675397825.65931
 CANADA                    |   1994 | 4699394286.04174
 CANADA                    |   1993 | 4669560940.05455
 CANADA                    |   1992 | 4683651400.97086
 CHINA                     |   1998 |  2736853684.0518
 CHINA                     |   1997 | 4685374831.66211
 CHINA                     |   1996 | 4717898882.62344
 CHINA                     |   1995 |  4677841910.2474
 CHINA                     |   1994 | 4669407034.43253
 CHINA                     |   1993 |  4671600591.9228
 CHINA                     |   1992 | 4709971055.66843
 EGYPT                     |   1998 | 2729952218.12434
 EGYPT                     |   1997 | 4641534842.52809
 EGYPT                     |   1996 | 4670473722.92103
 EGYPT                     |   1995 | 4670421748.75719
 EGYPT                     |   1994 | 4654443853.66385
 EGYPT                     |   1993 | 4668169783.55881
 EGYPT                     |   1992 | 4688740333.88524
 ETHIOPIA                  |   1998 | 2752301452.84594
 ETHIOPIA                  |   1997 | 4720002313.63937
 ETHIOPIA                  |   1996 | 4724104539.73826
 ETHIOPIA                  |   1995 | 4693279972.69906
 ETHIOPIA                  |   1994 | 4695553542.11834
 ETHIOPIA                  |   1993 | 4694737430.12952
 ETHIOPIA                  |   1992 | 4704009266.73823
 FRANCE                    |   1998 | 2738698024.06622
 FRANCE                    |   1997 | 4690796191.77469
 FRANCE                    |   1996 | 4701817215.17675
 FRANCE                    |   1995 | 4690176619.90496
 FRANCE                    |   1994 |  4686013457.5531
 FRANCE                    |   1993 | 4676541963.29096
 FRANCE                    |   1992 | 4720875554.29108
 GERMANY                   |   1998 | 2774232593.67745
 GERMANY                   |   1997 | 4686436383.01071
 GERMANY                   |   1996 | 4711296420.22689
 GERMANY                   |   1995 |  4684336442.3262
 GERMANY                   |   1994 | 4698296941.28784
 GERMANY                   |   1993 | 4711026907.02254
 GERMANY                   |   1992 | 4703448313.60227
 INDIA                     |   1998 | 2737634166.30219
 INDIA                     |   1997 | 4663781974.69099
 INDIA                     |   1996 | 4671103631.72158
 INDIA                     |   1995 | 4660109691.65707
 INDIA                     |   1994 | 4654834794.13822
 INDIA                     |   1993 | 4661476282.75931
 INDIA                     |   1992 | 4677842059.20708
 INDONESIA                 |   1998 | 2726682943.84136
 INDONESIA                 |   1997 | 4633807770.46881
 INDONESIA                 |   1996 | 4628747712.92818
 INDONESIA                 |   1995 | 4630586147.73312
 INDONESIA                 |   1994 |  4665366894.5167
 INDONESIA                 |   1993 | 4634069954.07887
 INDONESIA                 |   1992 | 4656415164.08194
 IRAN                      |   1998 | 2726040757.86327
 IRAN                      |   1997 | 4649083130.27622
 IRAN                      |   1996 | 4655297931.76002
 IRAN                      |   1995 | 4651794905.15969
 IRAN                      |   1994 |  4654206774.4214
 IRAN                      |   1993 | 4640904086.19729
 IRAN                      |   1992 | 4663195107.32606
 IRAQ                      |   1998 | 2735491741.59563
 IRAQ                      |   1997 | 4658942266.79168
 IRAQ                      |   1996 | 4671740015.35523
 IRAQ                      |   1995 | 4660737159.69859
 IRAQ                      |   1994 | 4659542777.74743
 IRAQ                      |   1993 | 4651262395.34059
 IRAQ                      |   1992 | 4669525133.77045
 JAPAN                     |   1998 | 2731033547.76894
 JAPAN                     |   1997 | 4631019648.38767
 JAPAN                     |   1996 | 4695124079.74214
 JAPAN                     |   1995 | 4626089056.65201
 JAPAN                     |   1994 | 4660620019.49635
 JAPAN                     |   1993 | 4630293511.38221
 JAPAN                     |   1992 |  4640712943.2338
 JORDAN                    |   1998 | 2763375272.96936
 JORDAN                    |   1997 | 4685337910.76541
 JORDAN                    |   1996 | 4688338956.86279
 JORDAN                    |   1995 |  4678137260.0542
 JORDAN                    |   1994 |  4682391348.9072
 JORDAN                    |   1993 | 4689952519.16525
 JORDAN                    |   1992 | 4674881994.83522
 KENYA                     |   1998 | 2717291200.79435
 KENYA                     |   1997 | 4634184612.22656
 KENYA                     |   1996 | 4648978314.84877
 KENYA                     |   1995 | 4633957060.20993
 KENYA                     |   1994 | 4630410423.33572
 KENYA                     |   1993 | 4617050812.72343
 KENYA                     |   1992 | 4633341028.50686
 MOROCCO                   |   1998 | 2746557768.56512
 MOROCCO                   |   1997 | 4709617918.13807
 MOROCCO                   |   1996 | 4715859182.08455
 MOROCCO                   |   1995 | 4701839763.83646
 MOROCCO                   |   1994 | 4709564155.11943
 MOROCCO                   |   1993 | 4702330568.70743
 MOROCCO                   |   1992 | 4716774235.55727
 MOZAMBIQUE                |   1998 | 2750395056.68653
 MOZAMBIQUE                |   1997 | 4689697950.43949
 MOZAMBIQUE                |   1996 | 4704176625.97543
 MOZAMBIQUE                |   1995 | 4695353748.63662
 MOZAMBIQUE                |   1994 | 4676253695.84512
 MOZAMBIQUE                |   1993 | 4685534422.68684
 MOZAMBIQUE                |   1992 | 4674590033.35314
 PERU                      |   1998 | 2704317957.88568
 PERU                      |   1997 | 4623379658.07398
 PERU                      |   1996 | 4635948028.82335
 PERU                      |   1995 | 4638098504.44244
 PERU                      |   1994 |  4633352270.6178
 PERU                      |   1993 | 4623151899.83379
 PERU                      |   1992 | 4652440482.44567
 ROMANIA                   |   1998 | 2763707393.93912
 ROMANIA                   |   1997 | 4696453634.14081
 ROMANIA                   |   1996 | 4705498005.77211
 ROMANIA                   |   1995 | 4684290993.71423
 ROMANIA                   |   1994 | 4700308046.17394
 ROMANIA                   |   1993 | 4688739853.04308
 ROMANIA                   |   1992 | 4699134064.72699
 RUSSIA                    |   1998 | 2736094590.02402
 RUSSIA                    |   1997 |  4663210740.4741
 RUSSIA                    |   1996 | 4697990266.19755
 RUSSIA                    |   1995 | 4656037938.04274
 RUSSIA                    |   1994 | 4650287701.73001
 RUSSIA                    |   1993 | 4662679599.38766
 RUSSIA                    |   1992 | 4682716394.76133
 SAUDI ARABIA              |   1998 | 2743532250.11261
 SAUDI ARABIA              |   1997 | 4685016931.87428
 SAUDI ARABIA              |   1996 | 4703116045.42779
 SAUDI ARABIA              |   1995 | 4677843675.61474
 SAUDI ARABIA              |   1994 | 4681290792.96803
 SAUDI ARABIA              |   1993 |   4689738654.319
 SAUDI ARABIA              |   1992 | 4688884125.47237
 UNITED KINGDOM            |   1998 | 2774793427.82929
 UNITED KINGDOM            |   1997 |   4716225894.086
 UNITED KINGDOM            |   1996 | 4696400104.62193
 UNITED KINGDOM            |   1995 | 4720405146.58093
 UNITED KINGDOM            |   1994 | 4724925507.52234
 UNITED KINGDOM            |   1993 | 4729882752.17229
 UNITED KINGDOM            |   1992 | 4729655393.87543
 UNITED STATES             |   1998 | 2751813506.50501
 UNITED STATES             |   1997 | 4747011776.41452
 UNITED STATES             |   1996 | 4690472704.68561
 UNITED STATES             |   1995 | 4698450650.51933
 UNITED STATES             |   1994 | 4727910979.15351
 UNITED STATES             |   1993 | 4699236845.12321
 UNITED STATES             |   1992 | 4727555824.06675
 VIETNAM                   |   1998 | 2734802612.39961
 VIETNAM                   |   1997 | 4662722723.11279
 VIETNAM                   |   1996 |  4686692542.2126
 VIETNAM                   |   1995 | 4683720318.92516
 VIETNAM                   |   1994 |  4690563366.4869
 VIETNAM                   |   1993 | 4665191972.40521
 VIETNAM                   |   1992 | 4692481729.52999
(175 rows)

COMMIT;
COMMIT
