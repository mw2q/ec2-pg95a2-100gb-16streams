BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%wheat%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2718510414.88694
 ALGERIA                   |   1997 | 4666313101.75656
 ALGERIA                   |   1996 | 4680045893.56117
 ALGERIA                   |   1995 | 4641530085.99517
 ALGERIA                   |   1994 | 4663777120.62441
 ALGERIA                   |   1993 |  4664411149.2402
 ALGERIA                   |   1992 | 4668723306.80903
 ARGENTINA                 |   1998 | 2714890647.85931
 ARGENTINA                 |   1997 | 4649994608.34914
 ARGENTINA                 |   1996 | 4663945730.15824
 ARGENTINA                 |   1995 | 4639758686.55568
 ARGENTINA                 |   1994 | 4660065371.60228
 ARGENTINA                 |   1993 | 4616481050.64966
 ARGENTINA                 |   1992 | 4646718696.67862
 BRAZIL                    |   1998 | 2732269277.24011
 BRAZIL                    |   1997 | 4661133220.15345
 BRAZIL                    |   1996 | 4693642217.89772
 BRAZIL                    |   1995 | 4668373266.05461
 BRAZIL                    |   1994 | 4656698807.35884
 BRAZIL                    |   1993 | 4660921640.81891
 BRAZIL                    |   1992 | 4642758233.33612
 CANADA                    |   1998 | 2747481621.42823
 CANADA                    |   1997 | 4662054484.87134
 CANADA                    |   1996 | 4671868962.56518
 CANADA                    |   1995 | 4693567210.65325
 CANADA                    |   1994 | 4683504855.92886
 CANADA                    |   1993 | 4674280847.60054
 CANADA                    |   1992 | 4655117710.39653
 CHINA                     |   1998 |  2748541264.2806
 CHINA                     |   1997 |  4684324394.2881
 CHINA                     |   1996 | 4708173544.31159
 CHINA                     |   1995 | 4682990240.23847
 CHINA                     |   1994 |  4666115843.6373
 CHINA                     |   1993 | 4694681926.42196
 CHINA                     |   1992 | 4675366779.90456
 EGYPT                     |   1998 | 2722712317.80326
 EGYPT                     |   1997 |    4677599707.74
 EGYPT                     |   1996 | 4668290104.38522
 EGYPT                     |   1995 | 4667871883.32379
 EGYPT                     |   1994 | 4672737934.30865
 EGYPT                     |   1993 | 4652707580.94105
 EGYPT                     |   1992 | 4684989133.59311
 ETHIOPIA                  |   1998 | 2765155979.07815
 ETHIOPIA                  |   1997 |  4689885713.1944
 ETHIOPIA                  |   1996 | 4703473032.64299
 ETHIOPIA                  |   1995 | 4701609000.23109
 ETHIOPIA                  |   1994 | 4683615744.60809
 ETHIOPIA                  |   1993 | 4695065646.51102
 ETHIOPIA                  |   1992 | 4698125087.28509
 FRANCE                    |   1998 | 2742961161.80897
 FRANCE                    |   1997 | 4669261254.88531
 FRANCE                    |   1996 | 4683519554.99158
 FRANCE                    |   1995 | 4672071654.61975
 FRANCE                    |   1994 |  4686824470.1519
 FRANCE                    |   1993 | 4663870170.79782
 FRANCE                    |   1992 | 4677591021.84052
 GERMANY                   |   1998 | 2738075133.74227
 GERMANY                   |   1997 | 4681847613.06627
 GERMANY                   |   1996 |  4712620858.3823
 GERMANY                   |   1995 | 4654963049.98386
 GERMANY                   |   1994 | 4653975812.87123
 GERMANY                   |   1993 | 4675346696.67852
 GERMANY                   |   1992 | 4697280930.26004
 INDIA                     |   1998 | 2736161733.63856
 INDIA                     |   1997 | 4656756819.33535
 INDIA                     |   1996 | 4658350097.88429
 INDIA                     |   1995 | 4641377171.39416
 INDIA                     |   1994 | 4672347483.49237
 INDIA                     |   1993 | 4677629270.67533
 INDIA                     |   1992 | 4668663165.42016
 INDONESIA                 |   1998 |  2729463945.5103
 INDONESIA                 |   1997 | 4630342977.09552
 INDONESIA                 |   1996 |  4617210807.7785
 INDONESIA                 |   1995 | 4625148720.40728
 INDONESIA                 |   1994 | 4664260551.06828
 INDONESIA                 |   1993 | 4633394598.19738
 INDONESIA                 |   1992 |  4657540878.5253
 IRAN                      |   1998 | 2717523987.04515
 IRAN                      |   1997 |  4653009313.5182
 IRAN                      |   1996 | 4627047053.08289
 IRAN                      |   1995 |  4621243625.0989
 IRAN                      |   1994 | 4621893639.24545
 IRAN                      |   1993 |  4650662636.7546
 IRAN                      |   1992 | 4646483140.24431
 IRAQ                      |   1998 | 2722992805.98562
 IRAQ                      |   1997 | 4635281008.50873
 IRAQ                      |   1996 | 4651649938.95121
 IRAQ                      |   1995 | 4653419610.04716
 IRAQ                      |   1994 | 4650122293.70248
 IRAQ                      |   1993 |  4631618490.7135
 IRAQ                      |   1992 | 4649052459.91034
 JAPAN                     |   1998 | 2701414640.35855
 JAPAN                     |   1997 |   4589982443.361
 JAPAN                     |   1996 | 4637185804.84087
 JAPAN                     |   1995 |  4590765918.0394
 JAPAN                     |   1994 | 4615790663.41509
 JAPAN                     |   1993 | 4603516968.49099
 JAPAN                     |   1992 | 4618947360.77366
 JORDAN                    |   1998 | 2713437010.88294
 JORDAN                    |   1997 | 4641129578.16601
 JORDAN                    |   1996 | 4660405049.47566
 JORDAN                    |   1995 | 4639369527.94946
 JORDAN                    |   1994 | 4629092818.65199
 JORDAN                    |   1993 | 4630817902.64983
 JORDAN                    |   1992 | 4645600597.47361
 KENYA                     |   1998 | 2723750331.71415
 KENYA                     |   1997 | 4633267183.58441
 KENYA                     |   1996 | 4663280553.34423
 KENYA                     |   1995 | 4648976711.12192
 KENYA                     |   1994 | 4610147513.24505
 KENYA                     |   1993 | 4616843810.42738
 KENYA                     |   1992 | 4654364291.99629
 MOROCCO                   |   1998 | 2741793356.83841
 MOROCCO                   |   1997 | 4691170729.81069
 MOROCCO                   |   1996 | 4693521798.46297
 MOROCCO                   |   1995 | 4656005090.81834
 MOROCCO                   |   1994 |  4696958845.7328
 MOROCCO                   |   1993 | 4688516019.98547
 MOROCCO                   |   1992 | 4679023178.16158
 MOZAMBIQUE                |   1998 |  2727593346.5736
 MOZAMBIQUE                |   1997 | 4683324438.38578
 MOZAMBIQUE                |   1996 | 4679369469.72471
 MOZAMBIQUE                |   1995 | 4670923710.13034
 MOZAMBIQUE                |   1994 | 4681800761.63819
 MOZAMBIQUE                |   1993 | 4660749922.79336
 MOZAMBIQUE                |   1992 | 4687311848.31476
 PERU                      |   1998 | 2713972289.77985
 PERU                      |   1997 | 4602539947.84746
 PERU                      |   1996 | 4643737663.74797
 PERU                      |   1995 |  4647720460.4585
 PERU                      |   1994 | 4611596323.27291
 PERU                      |   1993 | 4637039789.18129
 PERU                      |   1992 | 4667676656.86779
 ROMANIA                   |   1998 | 2738180889.52453
 ROMANIA                   |   1997 | 4668834141.99465
 ROMANIA                   |   1996 | 4717515658.04598
 ROMANIA                   |   1995 | 4695004944.09192
 ROMANIA                   |   1994 | 4682377785.29988
 ROMANIA                   |   1993 | 4669342247.18007
 ROMANIA                   |   1992 | 4683459187.68649
 RUSSIA                    |   1998 | 2708172715.73586
 RUSSIA                    |   1997 | 4663074295.74706
 RUSSIA                    |   1996 | 4666147810.91368
 RUSSIA                    |   1995 |  4642756423.6021
 RUSSIA                    |   1994 | 4633937310.18859
 RUSSIA                    |   1993 | 4640242240.50251
 RUSSIA                    |   1992 | 4668608361.36577
 SAUDI ARABIA              |   1998 | 2704115144.94707
 SAUDI ARABIA              |   1997 | 4631863588.73985
 SAUDI ARABIA              |   1996 | 4658886238.92469
 SAUDI ARABIA              |   1995 | 4651790156.13448
 SAUDI ARABIA              |   1994 |  4650304853.2804
 SAUDI ARABIA              |   1993 | 4648525599.70255
 SAUDI ARABIA              |   1992 | 4662089145.31195
 UNITED KINGDOM            |   1998 | 2775944222.71001
 UNITED KINGDOM            |   1997 | 4714767759.91042
 UNITED KINGDOM            |   1996 | 4740705976.29173
 UNITED KINGDOM            |   1995 | 4698283071.10749
 UNITED KINGDOM            |   1994 |  4739025313.9937
 UNITED KINGDOM            |   1993 | 4702471616.81281
 UNITED KINGDOM            |   1992 | 4730868445.47174
 UNITED STATES             |   1998 | 2735447197.13047
 UNITED STATES             |   1997 |  4644108591.0357
 UNITED STATES             |   1996 | 4667575735.17789
 UNITED STATES             |   1995 | 4652961142.87109
 UNITED STATES             |   1994 | 4676652246.07837
 UNITED STATES             |   1993 | 4672063544.13713
 UNITED STATES             |   1992 | 4690001763.53379
 VIETNAM                   |   1998 | 2742030326.28246
 VIETNAM                   |   1997 | 4682957930.52949
 VIETNAM                   |   1996 | 4698997606.61459
 VIETNAM                   |   1995 |  4687578037.9068
 VIETNAM                   |   1994 | 4713763583.72181
 VIETNAM                   |   1993 | 4688803403.18887
 VIETNAM                   |   1992 | 4693226907.13037
(175 rows)

COMMIT;
COMMIT
