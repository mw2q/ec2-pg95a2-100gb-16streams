BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%magenta%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2745631584.52713
 ALGERIA                   |   1997 | 4661489050.65349
 ALGERIA                   |   1996 | 4671501039.62461
 ALGERIA                   |   1995 | 4673022353.47669
 ALGERIA                   |   1994 |  4664759930.0818
 ALGERIA                   |   1993 | 4676794710.33143
 ALGERIA                   |   1992 | 4684045231.67679
 ARGENTINA                 |   1998 |  2716387706.3167
 ARGENTINA                 |   1997 | 4672324037.16372
 ARGENTINA                 |   1996 | 4656297508.79258
 ARGENTINA                 |   1995 |   4642892437.789
 ARGENTINA                 |   1994 | 4646108957.82818
 ARGENTINA                 |   1993 | 4659367265.43541
 ARGENTINA                 |   1992 | 4650148905.60046
 BRAZIL                    |   1998 | 2739191598.22438
 BRAZIL                    |   1997 |  4654636268.1642
 BRAZIL                    |   1996 | 4652953447.17606
 BRAZIL                    |   1995 | 4640313185.83748
 BRAZIL                    |   1994 | 4642750636.88033
 BRAZIL                    |   1993 | 4635324656.26908
 BRAZIL                    |   1992 | 4669420968.93867
 CANADA                    |   1998 | 2741550055.17446
 CANADA                    |   1997 | 4679794027.18834
 CANADA                    |   1996 |  4702123159.5874
 CANADA                    |   1995 | 4696263073.48361
 CANADA                    |   1994 | 4657385010.11525
 CANADA                    |   1993 | 4690940075.64632
 CANADA                    |   1992 | 4694366540.41612
 CHINA                     |   1998 |  2741601378.2225
 CHINA                     |   1997 | 4671089350.41772
 CHINA                     |   1996 | 4682921843.35868
 CHINA                     |   1995 | 4661085255.10389
 CHINA                     |   1994 | 4681360488.74286
 CHINA                     |   1993 |  4658227432.5021
 CHINA                     |   1992 | 4657681224.87419
 EGYPT                     |   1998 | 2735800704.24429
 EGYPT                     |   1997 | 4667238676.17885
 EGYPT                     |   1996 | 4688945167.03201
 EGYPT                     |   1995 | 4673168538.10137
 EGYPT                     |   1994 | 4667454712.04233
 EGYPT                     |   1993 | 4679390661.73175
 EGYPT                     |   1992 | 4665233143.33647
 ETHIOPIA                  |   1998 | 2748284470.69764
 ETHIOPIA                  |   1997 | 4689404735.52662
 ETHIOPIA                  |   1996 | 4691430616.04872
 ETHIOPIA                  |   1995 |  4698537143.8371
 ETHIOPIA                  |   1994 | 4665506183.02573
 ETHIOPIA                  |   1993 | 4685977370.19257
 ETHIOPIA                  |   1992 | 4689253831.58518
 FRANCE                    |   1998 | 2753834022.55438
 FRANCE                    |   1997 | 4694254401.63723
 FRANCE                    |   1996 | 4710891083.97082
 FRANCE                    |   1995 |    4709608175.72
 FRANCE                    |   1994 | 4700944989.01667
 FRANCE                    |   1993 | 4719796721.99913
 FRANCE                    |   1992 | 4685885795.82373
 GERMANY                   |   1998 | 2748050158.85513
 GERMANY                   |   1997 | 4684040917.56296
 GERMANY                   |   1996 | 4689056649.47256
 GERMANY                   |   1995 | 4695176923.22541
 GERMANY                   |   1994 | 4697372373.46091
 GERMANY                   |   1993 | 4698483055.48362
 GERMANY                   |   1992 | 4701327721.45371
 INDIA                     |   1998 | 2744263328.29403
 INDIA                     |   1997 |  4655064349.4191
 INDIA                     |   1996 | 4666335040.58404
 INDIA                     |   1995 | 4669294982.89542
 INDIA                     |   1994 |  4661724004.6703
 INDIA                     |   1993 | 4686068230.74342
 INDIA                     |   1992 | 4669999101.51494
 INDONESIA                 |   1998 | 2737742630.50183
 INDONESIA                 |   1997 | 4643886795.08233
 INDONESIA                 |   1996 | 4647859351.13208
 INDONESIA                 |   1995 | 4658830912.72569
 INDONESIA                 |   1994 | 4652894822.58176
 INDONESIA                 |   1993 | 4626011455.05147
 INDONESIA                 |   1992 |  4656142640.8251
 IRAN                      |   1998 | 2705878009.17286
 IRAN                      |   1997 | 4617271741.24042
 IRAN                      |   1996 | 4640157471.23058
 IRAN                      |   1995 | 4624816334.05282
 IRAN                      |   1994 | 4642591937.00622
 IRAN                      |   1993 | 4648119342.77828
 IRAN                      |   1992 | 4645034568.62711
 IRAQ                      |   1998 |  2731522117.3059
 IRAQ                      |   1997 | 4654900565.04655
 IRAQ                      |   1996 | 4656180864.30199
 IRAQ                      |   1995 | 4613812787.95917
 IRAQ                      |   1994 | 4656483021.46417
 IRAQ                      |   1993 | 4663463518.74123
 IRAQ                      |   1992 | 4648868384.20454
 JAPAN                     |   1998 | 2704721974.64259
 JAPAN                     |   1997 | 4607780183.17049
 JAPAN                     |   1996 | 4646951627.85834
 JAPAN                     |   1995 | 4641257507.31355
 JAPAN                     |   1994 | 4617454848.48937
 JAPAN                     |   1993 | 4627418461.07024
 JAPAN                     |   1992 | 4648446496.78262
 JORDAN                    |   1998 | 2734632346.21242
 JORDAN                    |   1997 | 4684974587.39037
 JORDAN                    |   1996 |  4679009987.5017
 JORDAN                    |   1995 | 4658440162.33557
 JORDAN                    |   1994 | 4666362743.16295
 JORDAN                    |   1993 | 4658971153.99887
 JORDAN                    |   1992 | 4682288305.43542
 KENYA                     |   1998 | 2722177732.28384
 KENYA                     |   1997 | 4637198463.48459
 KENYA                     |   1996 | 4652408116.04548
 KENYA                     |   1995 | 4629045067.53022
 KENYA                     |   1994 | 4646957070.53741
 KENYA                     |   1993 | 4647864045.82196
 KENYA                     |   1992 | 4649018622.46931
 MOROCCO                   |   1998 | 2755499620.23995
 MOROCCO                   |   1997 | 4678874902.01966
 MOROCCO                   |   1996 | 4681628997.57792
 MOROCCO                   |   1995 | 4682569610.45862
 MOROCCO                   |   1994 | 4655266396.48739
 MOROCCO                   |   1993 |  4659909519.5898
 MOROCCO                   |   1992 | 4674182099.74324
 MOZAMBIQUE                |   1998 | 2720279469.03151
 MOZAMBIQUE                |   1997 | 4647171561.41056
 MOZAMBIQUE                |   1996 | 4688224302.59436
 MOZAMBIQUE                |   1995 | 4659877327.41378
 MOZAMBIQUE                |   1994 | 4650940207.03355
 MOZAMBIQUE                |   1993 | 4674132478.14663
 MOZAMBIQUE                |   1992 | 4650770703.42145
 PERU                      |   1998 | 2717307816.21496
 PERU                      |   1997 | 4609821763.17287
 PERU                      |   1996 | 4639218170.74607
 PERU                      |   1995 | 4614087957.59885
 PERU                      |   1994 | 4619834286.15518
 PERU                      |   1993 | 4591026819.21945
 PERU                      |   1992 | 4624750829.58286
 ROMANIA                   |   1998 | 2734973853.81841
 ROMANIA                   |   1997 |  4647477199.7963
 ROMANIA                   |   1996 | 4685854201.77505
 ROMANIA                   |   1995 | 4651292248.33557
 ROMANIA                   |   1994 | 4669576097.52667
 ROMANIA                   |   1993 |  4688164102.4028
 ROMANIA                   |   1992 | 4678600506.37633
 RUSSIA                    |   1998 | 2718900903.03726
 RUSSIA                    |   1997 | 4672324275.28706
 RUSSIA                    |   1996 | 4677013442.59953
 RUSSIA                    |   1995 |  4642199878.6992
 RUSSIA                    |   1994 | 4644638103.96978
 RUSSIA                    |   1993 | 4684864408.91547
 RUSSIA                    |   1992 | 4670631126.49055
 SAUDI ARABIA              |   1998 | 2732260315.51186
 SAUDI ARABIA              |   1997 | 4613423540.68063
 SAUDI ARABIA              |   1996 | 4635797804.49683
 SAUDI ARABIA              |   1995 | 4631086070.92441
 SAUDI ARABIA              |   1994 | 4608484362.61134
 SAUDI ARABIA              |   1993 | 4627725051.34057
 SAUDI ARABIA              |   1992 | 4630495243.80686
 UNITED KINGDOM            |   1998 | 2751411550.26181
 UNITED KINGDOM            |   1997 | 4710516359.33714
 UNITED KINGDOM            |   1996 | 4714314145.94261
 UNITED KINGDOM            |   1995 | 4677919201.82364
 UNITED KINGDOM            |   1994 | 4675202796.14889
 UNITED KINGDOM            |   1993 | 4699882965.63648
 UNITED KINGDOM            |   1992 | 4702167887.63347
 UNITED STATES             |   1998 | 2740767011.96573
 UNITED STATES             |   1997 | 4664951313.67745
 UNITED STATES             |   1996 | 4712482864.01345
 UNITED STATES             |   1995 | 4664735742.90112
 UNITED STATES             |   1994 | 4665902601.19991
 UNITED STATES             |   1993 | 4679081609.95168
 UNITED STATES             |   1992 | 4664354959.27504
 VIETNAM                   |   1998 | 2734418450.85308
 VIETNAM                   |   1997 | 4681224378.97229
 VIETNAM                   |   1996 | 4679850638.69727
 VIETNAM                   |   1995 | 4701520432.80567
 VIETNAM                   |   1994 |  4652967100.1403
 VIETNAM                   |   1993 | 4674404463.53269
 VIETNAM                   |   1992 | 4699563765.30246
(175 rows)

COMMIT;
COMMIT
