BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%azure%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2738148338.40312
 ALGERIA                   |   1997 | 4648009623.06258
 ALGERIA                   |   1996 | 4662044912.74974
 ALGERIA                   |   1995 | 4634336338.06866
 ALGERIA                   |   1994 | 4637384313.02485
 ALGERIA                   |   1993 | 4669601870.98634
 ALGERIA                   |   1992 | 4666062828.44137
 ARGENTINA                 |   1998 | 2712138794.87608
 ARGENTINA                 |   1997 | 4665513512.39907
 ARGENTINA                 |   1996 | 4657684843.86933
 ARGENTINA                 |   1995 | 4618037426.29227
 ARGENTINA                 |   1994 | 4628619757.15789
 ARGENTINA                 |   1993 | 4624794345.93877
 ARGENTINA                 |   1992 | 4644418395.85813
 BRAZIL                    |   1998 | 2747698596.30805
 BRAZIL                    |   1997 | 4692244343.35131
 BRAZIL                    |   1996 | 4710403381.82323
 BRAZIL                    |   1995 | 4663163019.80033
 BRAZIL                    |   1994 |  4659093744.9406
 BRAZIL                    |   1993 | 4677193638.76335
 BRAZIL                    |   1992 | 4697634497.34845
 CANADA                    |   1998 | 2760673910.40065
 CANADA                    |   1997 | 4719652290.55288
 CANADA                    |   1996 | 4728820124.97432
 CANADA                    |   1995 |   4697831220.322
 CANADA                    |   1994 | 4685588616.76482
 CANADA                    |   1993 | 4717343292.13422
 CANADA                    |   1992 | 4735533883.80963
 CHINA                     |   1998 | 2741343840.57042
 CHINA                     |   1997 | 4626112427.49986
 CHINA                     |   1996 | 4650951225.77371
 CHINA                     |   1995 | 4638735923.93668
 CHINA                     |   1994 | 4645428105.10335
 CHINA                     |   1993 | 4662181918.14016
 CHINA                     |   1992 | 4662535817.26459
 EGYPT                     |   1998 |  2743669466.2848
 EGYPT                     |   1997 | 4693210320.46343
 EGYPT                     |   1996 | 4683370154.20282
 EGYPT                     |   1995 | 4683983152.93798
 EGYPT                     |   1994 | 4670422117.15038
 EGYPT                     |   1993 | 4708448468.51769
 EGYPT                     |   1992 |   4679310833.372
 ETHIOPIA                  |   1998 | 2780191462.71922
 ETHIOPIA                  |   1997 | 4710792487.26235
 ETHIOPIA                  |   1996 | 4736576932.95878
 ETHIOPIA                  |   1995 | 4724771853.61509
 ETHIOPIA                  |   1994 | 4712947145.36485
 ETHIOPIA                  |   1993 | 4678239180.14941
 ETHIOPIA                  |   1992 |  4714009868.9501
 FRANCE                    |   1998 | 2757994665.35354
 FRANCE                    |   1997 |  4671741990.4601
 FRANCE                    |   1996 | 4684479177.03205
 FRANCE                    |   1995 | 4671938659.83121
 FRANCE                    |   1994 | 4679580515.24402
 FRANCE                    |   1993 | 4692213246.04041
 FRANCE                    |   1992 | 4716447881.66156
 GERMANY                   |   1998 | 2768756462.12697
 GERMANY                   |   1997 | 4709281556.88087
 GERMANY                   |   1996 | 4708877173.90228
 GERMANY                   |   1995 | 4703247278.80898
 GERMANY                   |   1994 | 4679410803.73024
 GERMANY                   |   1993 | 4719626690.07926
 GERMANY                   |   1992 | 4728489864.36013
 INDIA                     |   1998 |  2757289393.7918
 INDIA                     |   1997 | 4676558750.08171
 INDIA                     |   1996 | 4709620280.09353
 INDIA                     |   1995 | 4689774001.05261
 INDIA                     |   1994 | 4666845034.20851
 INDIA                     |   1993 | 4691227645.50008
 INDIA                     |   1992 |  4716839979.1629
 INDONESIA                 |   1998 |  2753564555.6803
 INDONESIA                 |   1997 | 4674878149.01425
 INDONESIA                 |   1996 | 4685325170.94499
 INDONESIA                 |   1995 | 4686601232.46049
 INDONESIA                 |   1994 |  4640467384.5385
 INDONESIA                 |   1993 | 4669472032.17512
 INDONESIA                 |   1992 | 4671749987.60067
 IRAN                      |   1998 |  2737108308.1643
 IRAN                      |   1997 | 4669517439.84031
 IRAN                      |   1996 | 4645897247.32927
 IRAN                      |   1995 | 4659038889.94499
 IRAN                      |   1994 | 4643290054.81164
 IRAN                      |   1993 | 4647990036.88056
 IRAN                      |   1992 | 4638708911.50315
 IRAQ                      |   1998 | 2747599044.87499
 IRAQ                      |   1997 | 4645821427.44267
 IRAQ                      |   1996 | 4694068075.22012
 IRAQ                      |   1995 | 4678597627.95655
 IRAQ                      |   1994 | 4642577554.36208
 IRAQ                      |   1993 | 4675421978.32111
 IRAQ                      |   1992 | 4692212238.07854
 JAPAN                     |   1998 |   2696803908.952
 JAPAN                     |   1997 | 4636993501.88833
 JAPAN                     |   1996 | 4644488997.13072
 JAPAN                     |   1995 | 4630586454.35149
 JAPAN                     |   1994 | 4643607377.08448
 JAPAN                     |   1993 | 4629297211.67777
 JAPAN                     |   1992 | 4641232280.80047
 JORDAN                    |   1998 | 2726086390.40965
 JORDAN                    |   1997 | 4692293969.54292
 JORDAN                    |   1996 | 4710367156.28351
 JORDAN                    |   1995 | 4643988190.77083
 JORDAN                    |   1994 |  4666480289.8681
 JORDAN                    |   1993 | 4651348391.08363
 JORDAN                    |   1992 | 4691635384.20138
 KENYA                     |   1998 | 2725011037.90058
 KENYA                     |   1997 | 4631999715.91622
 KENYA                     |   1996 | 4660184359.45005
 KENYA                     |   1995 | 4663916809.95594
 KENYA                     |   1994 | 4638797528.82637
 KENYA                     |   1993 | 4666517627.18121
 KENYA                     |   1992 | 4633413787.46978
 MOROCCO                   |   1998 | 2746452478.38513
 MOROCCO                   |   1997 | 4699272449.12402
 MOROCCO                   |   1996 | 4701220690.48705
 MOROCCO                   |   1995 | 4655954148.55978
 MOROCCO                   |   1994 | 4701431728.09162
 MOROCCO                   |   1993 | 4664410213.39382
 MOROCCO                   |   1992 | 4712564119.30064
 MOZAMBIQUE                |   1998 | 2742041060.01333
 MOZAMBIQUE                |   1997 |  4688327726.4036
 MOZAMBIQUE                |   1996 | 4695297282.80783
 MOZAMBIQUE                |   1995 | 4697043048.11185
 MOZAMBIQUE                |   1994 | 4659026534.88776
 MOZAMBIQUE                |   1993 | 4662110920.19553
 MOZAMBIQUE                |   1992 | 4702351136.61089
 PERU                      |   1998 | 2727577760.43444
 PERU                      |   1997 | 4659887212.11059
 PERU                      |   1996 | 4658416578.31477
 PERU                      |   1995 | 4652906935.16876
 PERU                      |   1994 | 4656402872.01784
 PERU                      |   1993 | 4660782695.02574
 PERU                      |   1992 | 4660563613.68301
 ROMANIA                   |   1998 | 2757049014.24641
 ROMANIA                   |   1997 | 4709962487.93826
 ROMANIA                   |   1996 | 4725646749.65194
 ROMANIA                   |   1995 | 4712547733.57781
 ROMANIA                   |   1994 | 4718014282.90489
 ROMANIA                   |   1993 |  4675363059.4622
 ROMANIA                   |   1992 |  4711495315.6981
 RUSSIA                    |   1998 | 2743443868.58382
 RUSSIA                    |   1997 | 4675501447.92616
 RUSSIA                    |   1996 | 4686354084.04944
 RUSSIA                    |   1995 | 4697834614.31672
 RUSSIA                    |   1994 | 4677790525.92747
 RUSSIA                    |   1993 | 4691545064.06808
 RUSSIA                    |   1992 | 4683849456.06745
 SAUDI ARABIA              |   1998 | 2733490323.26793
 SAUDI ARABIA              |   1997 | 4662911318.77702
 SAUDI ARABIA              |   1996 | 4660194674.32403
 SAUDI ARABIA              |   1995 | 4667213001.44453
 SAUDI ARABIA              |   1994 | 4684849323.38417
 SAUDI ARABIA              |   1993 |  4660379678.9165
 SAUDI ARABIA              |   1992 | 4660211328.85944
 UNITED KINGDOM            |   1998 | 2750415273.52723
 UNITED KINGDOM            |   1997 | 4707594793.10875
 UNITED KINGDOM            |   1996 |  4722889973.1059
 UNITED KINGDOM            |   1995 | 4701534316.36298
 UNITED KINGDOM            |   1994 | 4711691448.60896
 UNITED KINGDOM            |   1993 | 4702200715.93526
 UNITED KINGDOM            |   1992 | 4706648974.26484
 UNITED STATES             |   1998 | 2725743294.44798
 UNITED STATES             |   1997 | 4702176326.39256
 UNITED STATES             |   1996 | 4705346876.40887
 UNITED STATES             |   1995 | 4666262776.14893
 UNITED STATES             |   1994 | 4697953265.76226
 UNITED STATES             |   1993 | 4678717092.34768
 UNITED STATES             |   1992 | 4672419878.85323
 VIETNAM                   |   1998 | 2740473185.85759
 VIETNAM                   |   1997 | 4665973772.97097
 VIETNAM                   |   1996 | 4700500178.74726
 VIETNAM                   |   1995 | 4658070171.91521
 VIETNAM                   |   1994 | 4689172878.54291
 VIETNAM                   |   1993 | 4679389795.83864
 VIETNAM                   |   1992 | 4680512618.21406
(175 rows)

COMMIT;
COMMIT
