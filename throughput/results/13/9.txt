BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%frosted%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2747280743.40956
 ALGERIA                   |   1997 | 4658241885.90974
 ALGERIA                   |   1996 |  4671849229.2545
 ALGERIA                   |   1995 | 4679539395.88247
 ALGERIA                   |   1994 |  4650199264.1054
 ALGERIA                   |   1993 | 4682163186.18496
 ALGERIA                   |   1992 | 4672019158.18098
 ARGENTINA                 |   1998 | 2704404461.87404
 ARGENTINA                 |   1997 |  4617144988.2789
 ARGENTINA                 |   1996 | 4609529413.76789
 ARGENTINA                 |   1995 | 4631798370.96514
 ARGENTINA                 |   1994 | 4621028159.63797
 ARGENTINA                 |   1993 | 4607874614.57386
 ARGENTINA                 |   1992 | 4619069624.60618
 BRAZIL                    |   1998 | 2736618434.89921
 BRAZIL                    |   1997 | 4658385210.98692
 BRAZIL                    |   1996 | 4675233576.49537
 BRAZIL                    |   1995 | 4670328939.88706
 BRAZIL                    |   1994 | 4667774668.21471
 BRAZIL                    |   1993 | 4647102897.49703
 BRAZIL                    |   1992 | 4645007751.60823
 CANADA                    |   1998 | 2753723181.87094
 CANADA                    |   1997 | 4685390154.58584
 CANADA                    |   1996 | 4697860585.37034
 CANADA                    |   1995 | 4676967861.19872
 CANADA                    |   1994 | 4713124258.61125
 CANADA                    |   1993 | 4673167852.08125
 CANADA                    |   1992 | 4671718077.79421
 CHINA                     |   1998 | 2710572842.15317
 CHINA                     |   1997 | 4663163599.64257
 CHINA                     |   1996 |  4657115764.9275
 CHINA                     |   1995 | 4637371580.92911
 CHINA                     |   1994 | 4658175027.52009
 CHINA                     |   1993 | 4661359448.45282
 CHINA                     |   1992 | 4651279126.65051
 EGYPT                     |   1998 | 2747168168.98685
 EGYPT                     |   1997 |  4667789180.1669
 EGYPT                     |   1996 | 4698732086.39594
 EGYPT                     |   1995 | 4701292164.03606
 EGYPT                     |   1994 | 4653172308.01656
 EGYPT                     |   1993 | 4672682147.03252
 EGYPT                     |   1992 | 4682927733.88986
 ETHIOPIA                  |   1998 | 2753654240.00795
 ETHIOPIA                  |   1997 | 4679020687.16925
 ETHIOPIA                  |   1996 | 4711112428.36099
 ETHIOPIA                  |   1995 | 4692147695.25186
 ETHIOPIA                  |   1994 | 4712211033.91023
 ETHIOPIA                  |   1993 | 4690193829.31619
 ETHIOPIA                  |   1992 | 4708158433.85935
 FRANCE                    |   1998 | 2739158590.81898
 FRANCE                    |   1997 | 4705596592.61621
 FRANCE                    |   1996 | 4709938069.19033
 FRANCE                    |   1995 | 4689385749.86926
 FRANCE                    |   1994 | 4702250888.01647
 FRANCE                    |   1993 | 4693509122.82662
 FRANCE                    |   1992 | 4702513252.21765
 GERMANY                   |   1998 | 2746827065.76282
 GERMANY                   |   1997 |  4688327818.4994
 GERMANY                   |   1996 | 4673622386.19692
 GERMANY                   |   1995 | 4663565716.40654
 GERMANY                   |   1994 | 4671876653.52376
 GERMANY                   |   1993 |  4674284859.3259
 GERMANY                   |   1992 | 4690224023.00659
 INDIA                     |   1998 | 2736297230.32972
 INDIA                     |   1997 | 4668407174.91077
 INDIA                     |   1996 | 4683341945.89895
 INDIA                     |   1995 | 4654285652.51981
 INDIA                     |   1994 | 4665775802.69336
 INDIA                     |   1993 | 4675588066.69703
 INDIA                     |   1992 | 4690710054.98475
 INDONESIA                 |   1998 | 2739618490.93789
 INDONESIA                 |   1997 | 4625017559.73781
 INDONESIA                 |   1996 | 4641316428.38152
 INDONESIA                 |   1995 | 4632851463.78077
 INDONESIA                 |   1994 | 4634942369.36677
 INDONESIA                 |   1993 | 4628312312.56004
 INDONESIA                 |   1992 |  4627714604.1611
 IRAN                      |   1998 | 2710202578.44328
 IRAN                      |   1997 | 4623831837.51763
 IRAN                      |   1996 | 4661050344.22499
 IRAN                      |   1995 | 4646493532.77393
 IRAN                      |   1994 | 4633840530.16156
 IRAN                      |   1993 | 4616114959.28116
 IRAN                      |   1992 | 4652294336.39386
 IRAQ                      |   1998 | 2718502703.92622
 IRAQ                      |   1997 | 4659238251.60993
 IRAQ                      |   1996 | 4675169816.55827
 IRAQ                      |   1995 | 4653006836.52347
 IRAQ                      |   1994 |  4652380331.7357
 IRAQ                      |   1993 |  4661361229.0068
 IRAQ                      |   1992 | 4659543998.38027
 JAPAN                     |   1998 |  2729187142.3068
 JAPAN                     |   1997 |  4651846374.5799
 JAPAN                     |   1996 | 4648955110.71884
 JAPAN                     |   1995 | 4648718978.45291
 JAPAN                     |   1994 | 4631844886.15782
 JAPAN                     |   1993 | 4645203550.36611
 JAPAN                     |   1992 | 4675864666.37312
 JORDAN                    |   1998 | 2732575540.97358
 JORDAN                    |   1997 | 4619278799.36393
 JORDAN                    |   1996 | 4638669486.71539
 JORDAN                    |   1995 | 4602415705.61875
 JORDAN                    |   1994 | 4627719384.02698
 JORDAN                    |   1993 | 4624172521.15256
 JORDAN                    |   1992 | 4632626682.75341
 KENYA                     |   1998 | 2694848520.08333
 KENYA                     |   1997 |  4589423987.0298
 KENYA                     |   1996 | 4640321904.93031
 KENYA                     |   1995 | 4632512067.19141
 KENYA                     |   1994 | 4621829390.40524
 KENYA                     |   1993 | 4609159653.65995
 KENYA                     |   1992 | 4626533726.53602
 MOROCCO                   |   1998 | 2739609398.50789
 MOROCCO                   |   1997 | 4701938077.06484
 MOROCCO                   |   1996 | 4680737056.33947
 MOROCCO                   |   1995 | 4676106801.85956
 MOROCCO                   |   1994 | 4667367845.47787
 MOROCCO                   |   1993 | 4666841074.82544
 MOROCCO                   |   1992 | 4690348312.78971
 MOZAMBIQUE                |   1998 | 2723926418.72974
 MOZAMBIQUE                |   1997 | 4680399397.19061
 MOZAMBIQUE                |   1996 | 4650393754.60148
 MOZAMBIQUE                |   1995 | 4653315253.04901
 MOZAMBIQUE                |   1994 | 4653237775.74559
 MOZAMBIQUE                |   1993 | 4631472962.17631
 MOZAMBIQUE                |   1992 | 4653905200.84962
 PERU                      |   1998 | 2701200687.34094
 PERU                      |   1997 | 4644777247.58728
 PERU                      |   1996 | 4680565980.02543
 PERU                      |   1995 | 4641876113.56787
 PERU                      |   1994 | 4643524190.05535
 PERU                      |   1993 | 4634192416.00291
 PERU                      |   1992 | 4652330152.52038
 ROMANIA                   |   1998 | 2732725859.73588
 ROMANIA                   |   1997 | 4661374262.55519
 ROMANIA                   |   1996 | 4699936136.16946
 ROMANIA                   |   1995 | 4678295895.29706
 ROMANIA                   |   1994 | 4688626698.10152
 ROMANIA                   |   1993 | 4653232305.47483
 ROMANIA                   |   1992 | 4689847176.65987
 RUSSIA                    |   1998 |  2705574126.5818
 RUSSIA                    |   1997 |  4653320540.9102
 RUSSIA                    |   1996 | 4664420152.17987
 RUSSIA                    |   1995 | 4674492860.09488
 RUSSIA                    |   1994 | 4649523090.66793
 RUSSIA                    |   1993 | 4641192357.68855
 RUSSIA                    |   1992 | 4664685213.45292
 SAUDI ARABIA              |   1998 | 2716190225.52454
 SAUDI ARABIA              |   1997 | 4659672386.21592
 SAUDI ARABIA              |   1996 | 4667650956.32066
 SAUDI ARABIA              |   1995 | 4640035078.38793
 SAUDI ARABIA              |   1994 | 4645040515.42618
 SAUDI ARABIA              |   1993 | 4656028659.52447
 SAUDI ARABIA              |   1992 | 4647718154.89884
 UNITED KINGDOM            |   1998 | 2745774567.18256
 UNITED KINGDOM            |   1997 | 4663075251.81249
 UNITED KINGDOM            |   1996 | 4697103035.30834
 UNITED KINGDOM            |   1995 |  4666475649.4909
 UNITED KINGDOM            |   1994 | 4641868118.84193
 UNITED KINGDOM            |   1993 | 4686007895.29994
 UNITED KINGDOM            |   1992 | 4674652047.08131
 UNITED STATES             |   1998 | 2736436124.79414
 UNITED STATES             |   1997 | 4683650907.02556
 UNITED STATES             |   1996 |   4700527238.686
 UNITED STATES             |   1995 | 4673306152.11136
 UNITED STATES             |   1994 | 4702581930.65862
 UNITED STATES             |   1993 | 4653110921.00176
 UNITED STATES             |   1992 | 4677720242.62064
 VIETNAM                   |   1998 | 2750386305.96808
 VIETNAM                   |   1997 | 4652801111.75412
 VIETNAM                   |   1996 | 4686521442.52208
 VIETNAM                   |   1995 | 4664692841.15529
 VIETNAM                   |   1994 | 4683043052.07579
 VIETNAM                   |   1993 |  4673683484.9688
 VIETNAM                   |   1992 | 4706639840.92892
(175 rows)

COMMIT;
COMMIT
