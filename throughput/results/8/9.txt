BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%orchid%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |    sum_profit    
---------------------------+--------+------------------
 ALGERIA                   |   1998 | 2737640825.84161
 ALGERIA                   |   1997 |  4643491504.7743
 ALGERIA                   |   1996 |  4651900082.2312
 ALGERIA                   |   1995 | 4659055176.52128
 ALGERIA                   |   1994 | 4682410176.43845
 ALGERIA                   |   1993 | 4650034501.22149
 ALGERIA                   |   1992 | 4629851029.66156
 ARGENTINA                 |   1998 | 2718230134.85258
 ARGENTINA                 |   1997 | 4641825955.69491
 ARGENTINA                 |   1996 | 4655155643.41452
 ARGENTINA                 |   1995 | 4615598505.64598
 ARGENTINA                 |   1994 | 4617654935.49381
 ARGENTINA                 |   1993 |  4631043005.2848
 ARGENTINA                 |   1992 | 4653535169.75726
 BRAZIL                    |   1998 | 2734543275.57776
 BRAZIL                    |   1997 |   4646452010.159
 BRAZIL                    |   1996 |  4693326694.0129
 BRAZIL                    |   1995 | 4688536646.48374
 BRAZIL                    |   1994 | 4680264771.90955
 BRAZIL                    |   1993 | 4693807633.91529
 BRAZIL                    |   1992 | 4698245926.77278
 CANADA                    |   1998 | 2748242312.05742
 CANADA                    |   1997 | 4691031338.30652
 CANADA                    |   1996 | 4699331621.84396
 CANADA                    |   1995 | 4685972690.46688
 CANADA                    |   1994 | 4673724982.95143
 CANADA                    |   1993 |  4696405874.5932
 CANADA                    |   1992 | 4689358735.36198
 CHINA                     |   1998 | 2702878374.49515
 CHINA                     |   1997 | 4642256637.25229
 CHINA                     |   1996 | 4674891727.26539
 CHINA                     |   1995 | 4623276451.73161
 CHINA                     |   1994 | 4638838139.88378
 CHINA                     |   1993 | 4635995155.08291
 CHINA                     |   1992 | 4618532760.48823
 EGYPT                     |   1998 | 2734660821.75469
 EGYPT                     |   1997 |  4649994523.2087
 EGYPT                     |   1996 | 4666650633.96247
 EGYPT                     |   1995 | 4665839185.55979
 EGYPT                     |   1994 | 4668775389.80679
 EGYPT                     |   1993 | 4684230971.01562
 EGYPT                     |   1992 | 4684164772.92875
 ETHIOPIA                  |   1998 | 2764349047.79106
 ETHIOPIA                  |   1997 | 4694026046.25012
 ETHIOPIA                  |   1996 | 4728907814.61461
 ETHIOPIA                  |   1995 |  4711654398.2135
 ETHIOPIA                  |   1994 | 4715672000.41425
 ETHIOPIA                  |   1993 | 4705946951.57301
 ETHIOPIA                  |   1992 |  4736493061.6061
 FRANCE                    |   1998 |  2737317429.2808
 FRANCE                    |   1997 | 4662963624.48254
 FRANCE                    |   1996 | 4652864416.40335
 FRANCE                    |   1995 | 4665737831.71368
 FRANCE                    |   1994 | 4650151806.16241
 FRANCE                    |   1993 | 4631622330.55738
 FRANCE                    |   1992 | 4679630627.83898
 GERMANY                   |   1998 |  2769568362.1604
 GERMANY                   |   1997 | 4656196986.98786
 GERMANY                   |   1996 | 4683808417.95088
 GERMANY                   |   1995 | 4666665784.82544
 GERMANY                   |   1994 | 4661343654.25858
 GERMANY                   |   1993 | 4675335371.38163
 GERMANY                   |   1992 | 4691265495.28017
 INDIA                     |   1998 | 2731044302.34903
 INDIA                     |   1997 | 4660391520.37402
 INDIA                     |   1996 | 4675713817.34173
 INDIA                     |   1995 | 4635223196.86577
 INDIA                     |   1994 | 4679898013.75568
 INDIA                     |   1993 | 4658686293.15967
 INDIA                     |   1992 | 4649854201.38512
 INDONESIA                 |   1998 | 2715336301.95311
 INDONESIA                 |   1997 | 4636204335.69945
 INDONESIA                 |   1996 | 4630297021.84917
 INDONESIA                 |   1995 |  4624654171.7564
 INDONESIA                 |   1994 |  4648859568.3124
 INDONESIA                 |   1993 | 4636755573.10942
 INDONESIA                 |   1992 |   4645676908.661
 IRAN                      |   1998 | 2708597523.08223
 IRAN                      |   1997 | 4605256287.51694
 IRAN                      |   1996 | 4629487433.01819
 IRAN                      |   1995 | 4625889221.90025
 IRAN                      |   1994 | 4602998196.59319
 IRAN                      |   1993 | 4610098135.10964
 IRAN                      |   1992 | 4595556682.76913
 IRAQ                      |   1998 | 2713856964.76516
 IRAQ                      |   1997 | 4635789665.20308
 IRAQ                      |   1996 | 4677480740.10732
 IRAQ                      |   1995 | 4664153224.73526
 IRAQ                      |   1994 |  4628379856.7902
 IRAQ                      |   1993 | 4649688698.67781
 IRAQ                      |   1992 | 4677048568.19334
 JAPAN                     |   1998 | 2716278410.62627
 JAPAN                     |   1997 |  4619236124.1748
 JAPAN                     |   1996 | 4658114578.44657
 JAPAN                     |   1995 | 4621324843.64359
 JAPAN                     |   1994 | 4648308832.17831
 JAPAN                     |   1993 | 4617124727.86942
 JAPAN                     |   1992 | 4639243713.22594
 JORDAN                    |   1998 | 2738169310.90724
 JORDAN                    |   1997 | 4643603855.44206
 JORDAN                    |   1996 | 4667391867.62573
 JORDAN                    |   1995 |  4648912404.1907
 JORDAN                    |   1994 | 4655113639.65316
 JORDAN                    |   1993 | 4645743338.25202
 JORDAN                    |   1992 | 4668033767.03284
 KENYA                     |   1998 |  2724734901.6749
 KENYA                     |   1997 | 4657961273.86513
 KENYA                     |   1996 | 4670945429.07067
 KENYA                     |   1995 | 4659689564.28527
 KENYA                     |   1994 |  4637897035.7733
 KENYA                     |   1993 | 4645709639.48728
 KENYA                     |   1992 | 4624153152.22266
 MOROCCO                   |   1998 | 2757590130.85974
 MOROCCO                   |   1997 | 4681354486.57728
 MOROCCO                   |   1996 | 4695194385.93496
 MOROCCO                   |   1995 | 4664497389.88664
 MOROCCO                   |   1994 | 4687533506.39802
 MOROCCO                   |   1993 | 4706382063.52002
 MOROCCO                   |   1992 | 4705412992.46264
 MOZAMBIQUE                |   1998 | 2717836960.89934
 MOZAMBIQUE                |   1997 | 4664256616.46795
 MOZAMBIQUE                |   1996 | 4665070276.17552
 MOZAMBIQUE                |   1995 | 4684467080.51109
 MOZAMBIQUE                |   1994 | 4629195422.88952
 MOZAMBIQUE                |   1993 | 4646194823.28318
 MOZAMBIQUE                |   1992 | 4667965051.48289
 PERU                      |   1998 | 2687232486.58945
 PERU                      |   1997 | 4594761271.50808
 PERU                      |   1996 | 4628198582.27482
 PERU                      |   1995 | 4584034231.18889
 PERU                      |   1994 | 4603072348.36713
 PERU                      |   1993 |  4604111606.3793
 PERU                      |   1992 |  4654923182.2279
 ROMANIA                   |   1998 | 2737809058.47841
 ROMANIA                   |   1997 | 4672060233.50183
 ROMANIA                   |   1996 | 4681635866.58992
 ROMANIA                   |   1995 | 4657463642.89893
 ROMANIA                   |   1994 | 4660409112.26671
 ROMANIA                   |   1993 |  4670096482.9794
 ROMANIA                   |   1992 | 4673243162.88616
 RUSSIA                    |   1998 | 2706600453.74435
 RUSSIA                    |   1997 | 4648391837.09833
 RUSSIA                    |   1996 | 4657389527.71409
 RUSSIA                    |   1995 | 4672081089.07767
 RUSSIA                    |   1994 | 4653090488.81835
 RUSSIA                    |   1993 | 4643920757.27695
 RUSSIA                    |   1992 | 4672240146.57204
 SAUDI ARABIA              |   1998 | 2721499054.54831
 SAUDI ARABIA              |   1997 | 4661836521.88332
 SAUDI ARABIA              |   1996 | 4681844666.96972
 SAUDI ARABIA              |   1995 |  4640440557.3633
 SAUDI ARABIA              |   1994 |  4659971579.2781
 SAUDI ARABIA              |   1993 | 4640994439.89027
 SAUDI ARABIA              |   1992 | 4665746790.50924
 UNITED KINGDOM            |   1998 | 2745655902.31057
 UNITED KINGDOM            |   1997 | 4687044315.20023
 UNITED KINGDOM            |   1996 | 4706196001.51567
 UNITED KINGDOM            |   1995 | 4686415032.99728
 UNITED KINGDOM            |   1994 | 4675065322.55674
 UNITED KINGDOM            |   1993 | 4674463614.32508
 UNITED KINGDOM            |   1992 |  4674471128.9054
 UNITED STATES             |   1998 | 2751417612.12254
 UNITED STATES             |   1997 | 4682068287.23511
 UNITED STATES             |   1996 | 4702223812.85479
 UNITED STATES             |   1995 | 4669790670.54762
 UNITED STATES             |   1994 | 4701111206.67988
 UNITED STATES             |   1993 | 4675978069.82832
 UNITED STATES             |   1992 | 4682745921.24746
 VIETNAM                   |   1998 | 2746775156.61234
 VIETNAM                   |   1997 | 4669781407.64442
 VIETNAM                   |   1996 | 4719324697.09816
 VIETNAM                   |   1995 | 4674453065.34071
 VIETNAM                   |   1994 | 4656887784.05626
 VIETNAM                   |   1993 |  4660800566.1438
 VIETNAM                   |   1992 | 4677840422.87255
(175 rows)

COMMIT;
COMMIT
